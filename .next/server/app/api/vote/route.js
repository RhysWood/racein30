(()=>{var e={};e.id=826,e.ids=[826],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},38568:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037);let o=new n.Schema({race:{type:String,required:!0},date:{type:Date,required:!0},sprint:{type:Boolean,default:!1},votes:{fullRace:{type:Number,default:0},raceIn30:{type:Number,default:0}}}),s=n.models.RaceWeekend||n.model("RaceWeekend",o)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>u,serverHooks:()=>y,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{POST:()=>d});var o=r(96559),s=r(48088),a=r(37719),i=r(69771),c=r(38568);let p=async(e,t)=>{try{let r={raceId:e,voteType:t,timestamp:new Date,metadata:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,userAgent:"test",language:"test",platform:"test",screenSize:"test",referrer:"undefined"!=typeof document?document.referrer:"test",deviceType:"desktop",timeOnPage:0,performanceMetrics:{pageLoadTime:0,domInteractive:0,firstContentfulPaint:"undefined"!=typeof performance&&performance.getEntriesByType("paint")[0]?performance.getEntriesByType("paint")[0]?.startTime:0},connection:{type:"undefined"!=typeof navigator&&navigator.connection&&navigator.connection?.effectiveType||"unknown",downlink:"undefined"!=typeof navigator&&navigator.connection?navigator.connection?.downlink:0}}};"undefined"!=typeof fetch?await fetch((()=>{{let e=process.env.NEXT_PUBLIC_SITE_URL||process.env.VERCEL_URL&&`https://${process.env.VERCEL_URL}`||"http://localhost:3000";return`${e}/api/analytics`}})(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}):console.warn("fetch is not available")}catch(e){console.error("Analytics error:",e)}};async function d(e){try{let{raceId:t,voteType:r}=await e.json();if(!t||!r)return new Response(JSON.stringify({error:"Missing required fields"}),{status:400});if(!["fullRace","raceIn30"].includes(r))return new Response(JSON.stringify({error:"Invalid vote type"}),{status:400});await (0,i.q)();let n=await c.A.findByIdAndUpdate(t,{$inc:{[`votes.${r}`]:1}},{new:!0});if(!n)return new Response(JSON.stringify({error:"Race not found"}),{status:404});try{await p(t,r)}catch(e){console.error("Analytics error:",e)}return new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Vote error:",e),new Response(JSON.stringify({error:"Failed to cast vote"}),{status:500,headers:{"Content-Type":"application/json"}})}}let u=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/vote/route",pathname:"/api/vote",filename:"route",bundlePath:"app/api/vote/route"},resolvedPagePath:"/home/rhys/dev/racein30/src/app/api/vote/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:l,workUnitAsyncStorage:f,serverHooks:y}=u;function v(){return(0,a.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:f})}},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69771:(e,t,r)=>{"use strict";r.d(t,{q:()=>s});var n=r(56037);let o=!1,s=async()=>{if(!o)try{await n.connect(process.env.MONGODB_URI),o=!0,console.log("MongoDB connected")}catch(e){console.log("MongoDB connection error:",e)}}},78335:()=>{},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[719],()=>r(47997));module.exports=n})();